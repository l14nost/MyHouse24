<!DOCTYPE html>
<html xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{admin/fragments/layout}">

<head>
  <title th:text = "#{left.sidebar.statistics}">Template</title>
</head>

<th:block layout:fragment="content">
  <div class="col-sm-12">
    <div class="card">
      <div class="card-header d-flex justify-content-between">
        <div class="header-title">
          <h4 class="card-title" th:text = "#{left.sidebar.statistics}"></h4>
        </div>
        <nav aria-label="breadcrumb">
          <ol class="breadcrumb">
            <li class="breadcrumb-item"><a th:text = "#{left.sidebar.statistics}"></a></li>
          </ol>
        </nav>
      </div>
      <div class="card-body px-0">
      </div>
    </div>
  </div>
  <div class="col-lg-4 col-md-6">
    <div class="card bg-soft-info">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center">
          <div class="bg-soft-info rounded p-3">
            <svg class="icon-20" xmlns="http://www.w3.org/2000/svg" width="20px" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"></path>
            </svg>
          </div>
          <div class="text-end">
            <h2 class="counter" style="visibility: visible;" th:text="${house}"></h2>
            <p th:text = "#{statistics.houses}"></p>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="col-lg-4 col-md-6">
    <div class="card bg-soft-warning">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center">
          <div class="bg-soft-warning rounded p-3">
            <svg class="icon-20" xmlns="http://www.w3.org/2000/svg" width="20px" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"></path>
            </svg>
          </div>
          <div class="text-end">
            <h2 class="counter" style="visibility: visible;" th:text="${owner}"></h2>
            <p th:text = "#{statistics.active.owner}"></p>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="col-lg-4 col-md-6">
    <div class="card bg-soft-gray">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center">
          <div class="bg-soft-gray rounded p-3">

            <svg class="icon-20" xmlns="http://www.w3.org/2000/svg" width="20px" viewBox="0 0 20 20" fill="currentColor">
              <path d="M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0zM12.93 17c.046-.327.07-.66.07-1a6.97 6.97 0 00-1.5-4.33A5 5 0 0119 16v1h-6.07zM6 11a5 5 0 015 5v1H1v-1a5 5 0 015-5z"></path>
            </svg>
          </div>
          <div class="text-end">
            <h2 class="counter" style="visibility: visible;" th:text="${masterApplicationAtWork}"></h2>
            <p th:text = "#{statistics.master.application}"></p>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="col-lg-4 col-md-6">
    <div class="card bg-soft-primary">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center">
          <div class="bg-soft-primary rounded p-3">
            <svg class="icon-20" xmlns="http://www.w3.org/2000/svg" width="20px" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"></path>
            </svg>
          </div>
          <div class="text-end">
            <h2 class="counter" style="visibility: visible;" th:text="${apartment}"></h2>
            <p th:text = "#{statistics.apartment}"></p>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="col-lg-4 col-md-6">
    <div class="card bg-soft-danger">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center">
          <div class="bg-soft-danger rounded p-3">
            <svg class="icon-20" xmlns="http://www.w3.org/2000/svg" width="20px" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"></path>
            </svg>
          </div>
          <div class="text-end">
            <h2 class="counter" style="visibility: visible;" th:text="${bankBook}"></h2>
            <p th:text = "#{statistics.bank.book}"></p>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="col-lg-4 col-md-6">
    <div class="card bg-soft-secondary">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center">
          <div class="bg-soft-secondary rounded p-3">
            <svg class="icon-20" xmlns="http://www.w3.org/2000/svg" width="20px" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"></path>
            </svg>
          </div>
          <div class="text-end">
            <h2 class="counter" style="visibility: visible;" th:text="${masterApplicationNew}"></h2>
            <p th:text = "#{statistics.master.application.new}"></p>
          </div>
        </div>
      </div>
    </div>
  </div>






  <div class="col-lg-8">
    <div class="card">
      <div class="card-body">
        <div class="d-flex flex-column">
          <div class="mb-6">
            <h5 th:text="#{statistics.chart1.title}"></h5>
          </div>
          <div class="border rounded ">
            <div id="extrachart1"></div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="col-lg-4">
    <div class="card" id="left-info">
      <div class="card-body p-3">
        <div class="d-flex justify-content-between mb-3">
          <div>
            <span th:text="#{statistics.widget1.title}"></span>
          </div>
          <div>
            <svg class="icon-20" xmlns="http://www.w3.org/2000/svg" width="20" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
            </svg>
          </div>
        </div>
        <div class="d-flex justify-content-between">
          <div class="d-flex align-items-center">
            <div class="border rounded p-3 bg-soft-danger me-3">
              <svg class="icon-24" xmlns="http://www.w3.org/2000/svg" width="24" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
            </div>
            <h2 class="counter" style="visibility: visible;" id="bank-book-expense"></h2>
          </div>
          <div class="pt-3">
            <svg class="icon-20" xmlns="http://www.w3.org/2000/svg" width="20px" viewBox="0 0 20 20" fill="#b91d12">
              <path d="M2 11a1 1 0 011-1h2a1 1 0 011 1v5a1 1 0 01-1 1H3a1 1 0 01-1-1v-5zM8 7a1 1 0 011-1h2a1 1 0 011 1v9a1 1 0 01-1 1H9a1 1 0 01-1-1V7zM14 4a1 1 0 011-1h2a1 1 0 011 1v12a1 1 0 01-1 1h-2a1 1 0 01-1-1V4z"></path>
            </svg>
          </div>
        </div>
      </div>
    </div>
    <div class="card">
      <div class="card-body p-3">
        <div class="d-flex justify-content-between mb-3">
          <div>
            <span th:text="#{statistics.widget2.title}"></span>
          </div>
          <div>
            <svg class="icon-20" xmlns="http://www.w3.org/2000/svg" width="20" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
            </svg>
          </div>
        </div>
        <div class="d-flex justify-content-between">
          <div class="d-flex align-items-center">
            <div class="border rounded p-3 bg-soft-primary me-3">
              <svg class="icon-24" xmlns="http://www.w3.org/2000/svg" width="24" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            </div>
            <h2 class="counter" style="visibility: visible;" id="bank-book-balance"></h2>
          </div>
          <div class="pt-3">
            <svg class="icon-20" xmlns="http://www.w3.org/2000/svg" width="20px" viewBox="0 0 20 20" fill="#b91d12">
              <path d="M2 11a1 1 0 011-1h2a1 1 0 011 1v5a1 1 0 01-1 1H3a1 1 0 01-1-1v-5zM8 7a1 1 0 011-1h2a1 1 0 011 1v9a1 1 0 01-1 1H9a1 1 0 01-1-1V7zM14 4a1 1 0 011-1h2a1 1 0 011 1v12a1 1 0 01-1 1h-2a1 1 0 01-1-1V4z"></path>
            </svg>
          </div>
        </div>
      </div>
    </div>
    <div class="card">
      <div class="card-body p-3">
        <div class="d-flex justify-content-between mb-3">
          <div>
            <span th:text="#{statistics.widget3.title}"></span>
          </div>
          <div>
            <svg class="icon-20" xmlns="http://www.w3.org/2000/svg" width="20" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
            </svg>
          </div>
        </div>
        <div class="d-flex justify-content-between">
          <div class="d-flex align-items-center">
            <div class="border rounded p-3 bg-soft-success me-3">
              <svg class="icon-24" xmlns="http://www.w3.org/2000/svg" width="24" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
            </div>
            <h2 class="counter" style="visibility: visible;" id="cash-box-state"></h2>
          </div>
          <div class="pt-3">
            <svg class="icon-20" xmlns="http://www.w3.org/2000/svg" width="20px" viewBox="0 0 20 20" fill="#b91d12">
              <path d="M2 11a1 1 0 011-1h2a1 1 0 011 1v5a1 1 0 01-1 1H3a1 1 0 01-1-1v-5zM8 7a1 1 0 011-1h2a1 1 0 011 1v9a1 1 0 01-1 1H9a1 1 0 01-1-1V7zM14 4a1 1 0 011-1h2a1 1 0 011 1v12a1 1 0 01-1 1h-2a1 1 0 01-1-1V4z"></path>
            </svg>
          </div>
        </div>
      </div>
    </div>
    </div>

  </div>





  <div class="col-lg-12">
    <div class="card">
      <div class="card-body">
        <div class="d-flex flex-column">
          <div class="mb-6">
            <h5 th:text="#{statistics.chart2.title}"></h5>
          </div>
          <div class="border rounded ">
            <div id="extrachart2"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

</th:block>

<!-- Extra Modals -->
<th:block layout:fragment="extra-modals">

  <!-- put extra modals here for only this page -->

</th:block>

<th:block layout:fragment="extra-script">
<script>

  let sockJs1 = new SockJS("/myhouse24-amirb-nikitaf/admin/ws");
  let stompClient = Stomp.over(sockJs1);

  function extraChart1(firstArray, secondArray) {
    if ($('#extrachart1').length) {
      const options = {
        series: [{
          name: '[[#{statistics.chart1.green}]]',
          data: firstArray
        }, {
          name: '[[#{statistics.chart1.red}]]',
          data: secondArray
        }],
        chart: {
          type: 'bar',
          height: 400
        },
        plotOptions: {
          bar: {
            borderRadius: 5,
            horizontal: false,
            columnWidth: '55%',
            endingShape: 'rounded'
          },
        },
        dataLabels: {
          enabled: false
        },
        stroke: {
          show: true,
          width: 2,
          colors: ['transparent']
        },
        xaxis: {
          categories: ['[[#{statistics.chart.Jan}]]', '[[#{statistics.chart.Feb}]]', '[[#{statistics.chart.Mar}]]', '[[#{statistics.chart.Apr}]]', '[[#{statistics.chart.May}]]', '[[#{statistics.chart.Jun}]]', '[[#{statistics.chart.Jul}]]', '[[#{statistics.chart.Aug}]]', '[[#{statistics.chart.Sep}]]', '[[#{statistics.chart.Oct}]]', '[[#{statistics.chart.Nov}]]', '[[#{statistics.chart.Dec}]]'],
        },
        fill: {
          opacity: 1,

          colors: ['#02851b', '#b91d12']

        },
        legend: {
          labels: {
            colors: ['#02851b', '#b91d12']
          },
          markers: {
            width: 100,
            fillColors: ['#02851b', '#b91d12']
          },
        },

        tooltip: {
          y: {
            formatter: function (val) {
              return "₴ " + val
            }
          }
        }
      };

      const chart = new ApexCharts(document.querySelector("#extrachart1"), options);
      chart.render();
    }
  }

  $(document).ready( async function () {

    stompClient.connect({}, (frame) => {
      console.log('Connected: ' + frame);
      stompClient.subscribe('/topic/statistics', () => {
        getStatistic();
      });
    });

    getStatistic();
    let firstArray = [];
    let secondArray = [];
    await $.ajax({
      url: "/myhouse24-amirb-nikitaf/admin/bills/get-sum-of-all-paid-bills",
      success: function (responseJSON) {
        firstArray = responseJSON;
      }
    });
    await $.ajax({
      url: "/myhouse24-amirb-nikitaf/admin/bills/get-sum-of-all-bills",
      success: function (responseJSON) {
        secondArray = responseJSON;
      }
    });
    extraChart1(firstArray,secondArray);


  });



  $(document).ready( async function () {
    let firstArray = [];
    let secondArray = [];
    await $.ajax({
      url: "/myhouse24-amirb-nikitaf/admin/cash-box/get-statistics-for-coming",
      success: function (responseJSON) {
        firstArray = responseJSON;
      }
    });
    await $.ajax({
      url: "/myhouse24-amirb-nikitaf/admin/cash-box/get-statistics-for-costs",
      success: function (responseJSON) {
        secondArray = responseJSON;
      }
    });

    extraChart2(firstArray,secondArray);


  });
function extraChart2(firstArray,secondArray){
  if($('#extrachart2').length) {
    const options = {
      series: [{
        name: '[[#{statistics.chart2.green}]]',
        data: firstArray
      }, {
        name: '[[#{statistics.chart2.red}]]',
        data: secondArray
      }],
      chart: {
        type: 'bar',
        height: 350
      },
      plotOptions: {
        bar: {
          borderRadius: 5,
          horizontal: false,
          columnWidth: '55%',
          endingShape: 'rounded'
        },
      },
      dataLabels: {
        enabled: false
      },
      stroke: {
        show: true,
        width: 2,
        colors: ['transparent']
      },
      xaxis: {
        categories: ['[[#{statistics.chart.Jan}]]','[[#{statistics.chart.Feb}]]','[[#{statistics.chart.Mar}]]','[[#{statistics.chart.Apr}]]','[[#{statistics.chart.May}]]','[[#{statistics.chart.Jun}]]','[[#{statistics.chart.Jul}]]','[[#{statistics.chart.Aug}]]','[[#{statistics.chart.Sep}]]','[[#{statistics.chart.Oct}]]','[[#{statistics.chart.Nov}]]','[[#{statistics.chart.Dec}]]' ],
      },
      fill: {
        opacity: 1,

        colors:['#02851b', '#b91d12']

      },
      legend:{
        labels:{
          colors:['#02851b', '#b91d12']
        },
        markers: {
          width: 100,
          fillColors:['#02851b', '#b91d12']
        },
      },

      tooltip: {
        y: {
          formatter: function (val) {
            return "₴ " + val
          }
        }
      }
    };
    $(document).ready(function () {
      $.ajax({
        url: "/myhouse24-amirb-nikitaf/admin/cash-box/get-statistics-for-coming",
        success: function (responseJSON) {
          options.series[0].data = responseJSON;
        },
        error: function (error) {
          options.series[0].data = null;
        }
      });

      $.ajax({
        url: "/myhouse24-amirb-nikitaf/admin/cash-box/get-statistics-for-costs",
        success: function (responseJSON) {
          options.series[1].data = responseJSON;
        },
        error: function (error) {
          options.series[1].data = null;
        }
      });
    });


    const chart = new ApexCharts(document.querySelector("#extrachart2"), options);
    chart.render();
  }
}

</script>
  <!-- put JS here for only this page -->

</th:block>

</html>

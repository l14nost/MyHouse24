<!DOCTYPE html>
<html xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{admin/fragments/layout}">

<head>
  <title th:text = "#{left.sidebar.statistics}">Template</title>
</head>

<th:block layout:fragment="content">
  <div class="col-sm-12">
    <div class="card">
      <div class="card-header d-flex justify-content-between">
        <div class="header-title">
          <h4 class="card-title" th:text = "#{left.sidebar.statistics}"></h4>
        </div>
        <nav aria-label="breadcrumb">
          <ol class="breadcrumb">
            <li class="breadcrumb-item"><a th:text = "#{left.sidebar.statistics}"></a></li>
          </ol>
        </nav>
      </div>
      <div class="card-body px-0">
      </div>
    </div>
  </div>
  <div class="col-lg-4 col-md-6">
    <div class="card bg-soft-info">
      <a th:href="@{/houses}" class="card-body">
        <div  class="d-flex justify-content-between align-items-center">
          <div class="bg-soft-info rounded p-3">
            <svg class="icon-20" xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 576 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. --><path fill="currentColor" d="M575.8 255.5c0 18-15 32.1-32 32.1h-32l.7 160.2c0 2.7-.2 5.4-.5 8.1V472c0 22.1-17.9 40-40 40H456c-1.1 0-2.2 0-3.3-.1c-1.4 .1-2.8 .1-4.2 .1H416 392c-22.1 0-40-17.9-40-40V448 384c0-17.7-14.3-32-32-32H256c-17.7 0-32 14.3-32 32v64 24c0 22.1-17.9 40-40 40H160 128.1c-1.5 0-3-.1-4.5-.2c-1.2 .1-2.4 .2-3.6 .2H104c-22.1 0-40-17.9-40-40V360c0-.9 0-1.9 .1-2.8V287.6H32c-18 0-32-14-32-32.1c0-9 3-17 10-24L266.4 8c7-7 15-8 22-8s15 2 21 7L564.8 231.5c8 7 12 15 11 24z"/></svg>
          </div>
          <div class="text-end">
            <h2 class="counter" style="visibility: visible" th:text="${house}"></h2>
            <p th:text = "#{statistics.houses}"></p>
          </div>
        </div>
      </a>
    </div>
  </div>
  <div class="col-lg-4 col-md-6">
    <div class="card bg-soft-warning">
      <a th:href="@{/users}" class="card-body">
        <div class="d-flex justify-content-between align-items-center">
          <div class="bg-soft-warning rounded p-3">
            <svg class="icon-20" xmlns="http://www.w3.org/2000/svg" width="20px" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"></path>
            </svg>
          </div>
          <div class="text-end">
            <h2 class="counter" style="visibility: visible;" th:text="${owner}"></h2>
            <p th:text = "#{statistics.active.owner}"></p>
          </div>
        </div>
      </a>
    </div>
  </div>
  <div class="col-lg-4 col-md-6">
    <div class="card bg-soft-gray">
      <a th:href="@{/master-call}" class="card-body">
        <div class="d-flex justify-content-between align-items-center">
          <div class="bg-soft-gray rounded p-3">
            <svg class="icon-20" xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 512 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. --><path fill="currentColor" d="M78.6 5C69.1-2.4 55.6-1.5 47 7L7 47c-8.5 8.5-9.4 22-2.1 31.6l80 104c4.5 5.9 11.6 9.4 19 9.4h54.1l109 109c-14.7 29-10 65.4 14.3 89.6l112 112c12.5 12.5 32.8 12.5 45.3 0l64-64c12.5-12.5 12.5-32.8 0-45.3l-112-112c-24.2-24.2-60.6-29-89.6-14.3l-109-109V104c0-7.5-3.5-14.5-9.4-19L78.6 5zM19.9 396.1C7.2 408.8 0 426.1 0 444.1C0 481.6 30.4 512 67.9 512c18 0 35.3-7.2 48-19.9L233.7 374.3c-7.8-20.9-9-43.6-3.6-65.1l-61.7-61.7L19.9 396.1zM512 144c0-10.5-1.1-20.7-3.2-30.5c-2.4-11.2-16.1-14.1-24.2-6l-63.9 63.9c-3 3-7.1 4.7-11.3 4.7H352c-8.8 0-16-7.2-16-16V102.6c0-4.2 1.7-8.3 4.7-11.3l63.9-63.9c8.1-8.1 5.2-21.8-6-24.2C388.7 1.1 378.5 0 368 0C288.5 0 224 64.5 224 144l0 .8 85.3 85.3c36-9.1 75.8 .5 104 28.7L429 274.5c49-23 83-72.8 83-130.5zM56 432a24 24 0 1 1 48 0 24 24 0 1 1 -48 0z"/></svg>
          </div>
          <div class="text-end">
            <h2 class="counter" style="visibility: visible;" th:text="${masterApplicationAtWork}"></h2>
            <p th:text = "#{statistics.master.application}"></p>
          </div>
        </div>
      </a>
    </div>
  </div>
  <div class="col-lg-4 col-md-6">
    <div class="card bg-soft-primary">
      <a th:href="@{/apartments}" class="card-body">
        <div class="d-flex justify-content-between align-items-center">
          <div class="bg-soft-primary rounded p-3">
            <svg class="icon-20" xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 576 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. --><path fill="currentColor" d="M320 32c0-9.9-4.5-19.2-12.3-25.2S289.8-1.4 280.2 1l-179.9 45C79 51.3 64 70.5 64 92.5V448H32c-17.7 0-32 14.3-32 32s14.3 32 32 32H96 288h32V480 32zM256 256c0 17.7-10.7 32-24 32s-24-14.3-24-32s10.7-32 24-32s24 14.3 24 32zm96-128h96V480c0 17.7 14.3 32 32 32h64c17.7 0 32-14.3 32-32s-14.3-32-32-32H512V128c0-35.3-28.7-64-64-64H352v64z"/></svg>
          </div>
          <div class="text-end">
            <h2 class="counter" style="visibility: visible;" th:text="${apartment}"></h2>
            <p th:text = "#{statistics.apartment}"></p>
          </div>
        </div>
      </a>
    </div>
  </div>
  <div class="col-lg-4 col-md-6">
    <div class="card bg-soft-danger">
      <a th:href="@{/bank-books}" class="card-body">
        <div class="d-flex justify-content-between align-items-center">
          <div class="bg-soft-danger rounded p-3">
            <svg class="icon-20" xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 576 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. --><path fill="currentColor" d="M64 32C28.7 32 0 60.7 0 96v32H576V96c0-35.3-28.7-64-64-64H64zM576 224H0V416c0 35.3 28.7 64 64 64H512c35.3 0 64-28.7 64-64V224zM112 352h64c8.8 0 16 7.2 16 16s-7.2 16-16 16H112c-8.8 0-16-7.2-16-16s7.2-16 16-16zm112 16c0-8.8 7.2-16 16-16H368c8.8 0 16 7.2 16 16s-7.2 16-16 16H240c-8.8 0-16-7.2-16-16z"/></svg>
          </div>
          <div class="text-end">
            <h2 class="counter" style="visibility: visible;" th:text="${bankBook}"></h2>
            <p th:text = "#{statistics.bank.book}"></p>
          </div>
        </div>
      </a>
    </div>
  </div>
  <div class="col-lg-4 col-md-6">
    <div class="card bg-soft-secondary">
      <a th:href="@{/master-call}" class="card-body">
        <div class="d-flex justify-content-between align-items-center">
          <div class="bg-soft-secondary rounded p-3">
            <svg class="icon-20" xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 512 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. --><path fill="currentColor" d="M352 320c88.4 0 160-71.6 160-160c0-15.3-2.2-30.1-6.2-44.2c-3.1-10.8-16.4-13.2-24.3-5.3l-76.8 76.8c-3 3-7.1 4.7-11.3 4.7H336c-8.8 0-16-7.2-16-16V118.6c0-4.2 1.7-8.3 4.7-11.3l76.8-76.8c7.9-7.9 5.4-21.2-5.3-24.3C382.1 2.2 367.3 0 352 0C263.6 0 192 71.6 192 160c0 19.1 3.4 37.5 9.5 54.5L19.9 396.1C7.2 408.8 0 426.1 0 444.1C0 481.6 30.4 512 67.9 512c18 0 35.3-7.2 48-19.9L297.5 310.5c17 6.2 35.4 9.5 54.5 9.5zM80 408a24 24 0 1 1 0 48 24 24 0 1 1 0-48z"/></svg>          </div>
          <div class="text-end">
            <h2 class="counter" style="visibility: visible;" th:text="${masterApplicationNew}"></h2>
            <p th:text = "#{statistics.master.application.new}"></p>
          </div>
        </div>
      </a>
    </div>
  </div>






  <div class="col-lg-8">
    <div class="card">
      <div class="card-body">
        <div class="d-flex flex-column">
          <div class="mb-6">
            <h5 th:text="#{statistics.chart1.title}"></h5>
          </div>
          <div class="border rounded ">
            <div id="extrachart1"></div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="col-lg-4">
    <div class="card" id="left-info">
      <div class="card-body p-3">
        <div class="d-flex justify-content-between mb-3">
          <div>
            <span th:text="#{statistics.widget1.title}"></span>
          </div>
          <div>
            <svg class="icon-20" xmlns="http://www.w3.org/2000/svg" width="20" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
            </svg>
          </div>
        </div>
        <div class="d-flex justify-content-between">
          <div class="d-flex align-items-center">
            <div class="border rounded p-3 bg-soft-danger me-3">
              <svg class="icon-24" xmlns="http://www.w3.org/2000/svg" width="24" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
            </div>
            <h2 class="counter" style="visibility: visible;" id="bank-book-expense"></h2>
          </div>
          <div class="pt-3">
            <svg class="icon-20" xmlns="http://www.w3.org/2000/svg" width="20px" viewBox="0 0 20 20" fill="#b91d12">
              <path d="M2 11a1 1 0 011-1h2a1 1 0 011 1v5a1 1 0 01-1 1H3a1 1 0 01-1-1v-5zM8 7a1 1 0 011-1h2a1 1 0 011 1v9a1 1 0 01-1 1H9a1 1 0 01-1-1V7zM14 4a1 1 0 011-1h2a1 1 0 011 1v12a1 1 0 01-1 1h-2a1 1 0 01-1-1V4z"></path>
            </svg>
          </div>
        </div>
      </div>
    </div>
    <div class="card">
      <div class="card-body p-3">
        <div class="d-flex justify-content-between mb-3">
          <div>
            <span th:text="#{statistics.widget2.title}"></span>
          </div>
          <div>
            <svg class="icon-20" xmlns="http://www.w3.org/2000/svg" width="20" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
            </svg>
          </div>
        </div>
        <div class="d-flex justify-content-between">
          <div class="d-flex align-items-center">
            <div class="border rounded p-3 bg-soft-primary me-3">
              <svg class="icon-24" xmlns="http://www.w3.org/2000/svg" width="24" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            </div>
            <h2 class="counter" style="visibility: visible;" id="bank-book-balance"></h2>
          </div>
          <div class="pt-3">
            <svg class="icon-20" xmlns="http://www.w3.org/2000/svg" width="20px" viewBox="0 0 20 20" fill="#b91d12">
              <path d="M2 11a1 1 0 011-1h2a1 1 0 011 1v5a1 1 0 01-1 1H3a1 1 0 01-1-1v-5zM8 7a1 1 0 011-1h2a1 1 0 011 1v9a1 1 0 01-1 1H9a1 1 0 01-1-1V7zM14 4a1 1 0 011-1h2a1 1 0 011 1v12a1 1 0 01-1 1h-2a1 1 0 01-1-1V4z"></path>
            </svg>
          </div>
        </div>
      </div>
    </div>
    <div class="card">
      <div class="card-body p-3">
        <div class="d-flex justify-content-between mb-3">
          <div>
            <span th:text="#{statistics.widget3.title}"></span>
          </div>
          <div>
            <svg class="icon-20" xmlns="http://www.w3.org/2000/svg" width="20" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
            </svg>
          </div>
        </div>
        <div class="d-flex justify-content-between">
          <div class="d-flex align-items-center">
            <div class="border rounded p-3 bg-soft-success me-3">
              <svg class="icon-24" xmlns="http://www.w3.org/2000/svg" width="24" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
            </div>
            <h2 class="counter" style="visibility: visible;" id="cash-box-state"></h2>
          </div>
          <div class="pt-3">
            <svg class="icon-20" xmlns="http://www.w3.org/2000/svg" width="20px" viewBox="0 0 20 20" fill="#b91d12">
              <path d="M2 11a1 1 0 011-1h2a1 1 0 011 1v5a1 1 0 01-1 1H3a1 1 0 01-1-1v-5zM8 7a1 1 0 011-1h2a1 1 0 011 1v9a1 1 0 01-1 1H9a1 1 0 01-1-1V7zM14 4a1 1 0 011-1h2a1 1 0 011 1v12a1 1 0 01-1 1h-2a1 1 0 01-1-1V4z"></path>
            </svg>
          </div>
        </div>
      </div>
    </div>
    </div>

  </div>





  <div class="col-lg-12">
    <div class="card">
      <div class="card-body">
        <div class="d-flex flex-column">
          <div class="mb-6">
            <h5 th:text="#{statistics.chart2.title}"></h5>
          </div>
          <div class="border rounded ">
            <div id="extrachart2"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

</th:block>

<!-- Extra Modals -->
<th:block layout:fragment="extra-modals">

  <!-- put extra modals here for only this page -->

</th:block>

<th:block layout:fragment="extra-script">
<script>

  let sockJs1 = new SockJS("/myhouse24-amirb-nikitaf/admin/ws");
  let stompClient = Stomp.over(sockJs1);

  function extraChart1(firstArray, secondArray) {
    if ($('#extrachart1').length) {
      const options = {
        series: [{
          name: '[[#{statistics.chart1.green}]]',
          data: firstArray
        }, {
          name: '[[#{statistics.chart1.red}]]',
          data: secondArray
        }],
        chart: {
          type: 'bar',
          height: 400
        },
        plotOptions: {
          bar: {
            borderRadius: 5,
            horizontal: false,
            columnWidth: '55%',
            endingShape: 'rounded'
          },
        },
        dataLabels: {
          enabled: false
        },
        stroke: {
          show: true,
          width: 2,
          colors: ['transparent']
        },
        xaxis: {
          categories: ['[[#{statistics.chart.Jan}]]', '[[#{statistics.chart.Feb}]]', '[[#{statistics.chart.Mar}]]', '[[#{statistics.chart.Apr}]]', '[[#{statistics.chart.May}]]', '[[#{statistics.chart.Jun}]]', '[[#{statistics.chart.Jul}]]', '[[#{statistics.chart.Aug}]]', '[[#{statistics.chart.Sep}]]', '[[#{statistics.chart.Oct}]]', '[[#{statistics.chart.Nov}]]', '[[#{statistics.chart.Dec}]]'],
        },
        fill: {
          opacity: 1,

          colors: ['#02851b', '#b91d12']

        },
        legend: {
          labels: {
            colors: ['#02851b', '#b91d12']
          },
          markers: {
            width: 100,
            fillColors: ['#02851b', '#b91d12']
          },
        },

        tooltip: {
          y: {
            formatter: function (val) {
              return "₴ " + val
            }
          }
        }
      };

      const chart = new ApexCharts(document.querySelector("#extrachart1"), options);
      chart.render();
    }
  }

  $(document).ready( async function () {

    stompClient.connect({}, (frame) => {
      console.log('Connected: ' + frame);
      stompClient.subscribe('/topic/statistics', () => {
        getStatistic();
      });
    });

    getStatistic();
    let firstArray = [];
    let secondArray = [];
    await $.ajax({
      url: "/myhouse24-amirb-nikitaf/admin/bills/get-sum-of-all-paid-bills",
      success: function (responseJSON) {
        firstArray = responseJSON;
      }
    });
    await $.ajax({
      url: "/myhouse24-amirb-nikitaf/admin/bills/get-sum-of-all-bills",
      success: function (responseJSON) {
        secondArray = responseJSON;
      }
    });
    extraChart1(firstArray,secondArray);


  });



  $(document).ready( async function () {
    let firstArray = [];
    let secondArray = [];
    await $.ajax({
      url: "/myhouse24-amirb-nikitaf/admin/cash-box/get-statistics-for-coming",
      success: function (responseJSON) {
        firstArray = responseJSON;
      }
    });
    await $.ajax({
      url: "/myhouse24-amirb-nikitaf/admin/cash-box/get-statistics-for-costs",
      success: function (responseJSON) {
        secondArray = responseJSON;
      }
    });

    extraChart2(firstArray,secondArray);


  });
function extraChart2(firstArray,secondArray){
  if($('#extrachart2').length) {
    const options = {
      series: [{
        name: '[[#{statistics.chart2.green}]]',
        data: firstArray
      }, {
        name: '[[#{statistics.chart2.red}]]',
        data: secondArray
      }],
      chart: {
        type: 'bar',
        height: 350
      },
      plotOptions: {
        bar: {
          borderRadius: 5,
          horizontal: false,
          columnWidth: '55%',
          endingShape: 'rounded'
        },
      },
      dataLabels: {
        enabled: false
      },
      stroke: {
        show: true,
        width: 2,
        colors: ['transparent']
      },
      xaxis: {
        categories: ['[[#{statistics.chart.Jan}]]','[[#{statistics.chart.Feb}]]','[[#{statistics.chart.Mar}]]','[[#{statistics.chart.Apr}]]','[[#{statistics.chart.May}]]','[[#{statistics.chart.Jun}]]','[[#{statistics.chart.Jul}]]','[[#{statistics.chart.Aug}]]','[[#{statistics.chart.Sep}]]','[[#{statistics.chart.Oct}]]','[[#{statistics.chart.Nov}]]','[[#{statistics.chart.Dec}]]' ],
      },
      fill: {
        opacity: 1,

        colors:['#02851b', '#b91d12']

      },
      legend:{
        labels:{
          colors:['#02851b', '#b91d12']
        },
        markers: {
          width: 100,
          fillColors:['#02851b', '#b91d12']
        },
      },

      tooltip: {
        y: {
          formatter: function (val) {
            return "₴ " + val
          }
        }
      }
    };
    $(document).ready(function () {
      $.ajax({
        url: "/myhouse24-amirb-nikitaf/admin/cash-box/get-statistics-for-coming",
        success: function (responseJSON) {
          options.series[0].data = responseJSON;
        },
        error: function (error) {
          options.series[0].data = null;
        }
      });

      $.ajax({
        url: "/myhouse24-amirb-nikitaf/admin/cash-box/get-statistics-for-costs",
        success: function (responseJSON) {
          options.series[1].data = responseJSON;
        },
        error: function (error) {
          options.series[1].data = null;
        }
      });
    });


    const chart = new ApexCharts(document.querySelector("#extrachart2"), options);
    chart.render();
  }
}

</script>
  <!-- put JS here for only this page -->

</th:block>

</html>
